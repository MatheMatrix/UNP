## 云平台与企业内网打通


###介绍
很多情况下客户有这样的需求：自己的企业内网需要与云平台网络打通，针对此种情况，我们提供了2种可行的解决方案。
####方案一：指定VLAN网络三层打通
通过指定vlan网络进行三层打通这种方式比较简单、性能好，关键在于UnitedStack核心路由上的策略路由的配置。
此方案只适用于VLAN网络。
#####前提
对于物理网络，云平台核心交换机需要与企业内网之间建立三层互联，并且云平台核心交换机需要配置策略路由。
对于云平台，需要确定要打通的VLAN ID（图中的Vlan 2001，2002），CIDR（图中的172.30.248.0/22）和该Vlan网络对应租户的tenant id。
#####拓扑结构以及原理说明

![1]
拓扑中红线部分表示虚拟机访问xx内网，黄线表示正常访问。10.10.10.0/24 代表xx内网。如果用户的核心与云平台核心是共用的，则无需互联地址可以直接直连路由。

#####用户使用过程

用户在由我们创建的 vlan 网络下创建虚拟机，当访问 10.10.10.0/24 网段时即可通向 xx 内网。如果 vlan 网络开启了"shared=True"，则任意用户都可以在这个 vlan 下创建虚拟机或加入这个网络，但目前前端界面上暂不支持指定某个基础网络；也可以将这个 Vlan 网络创建到指定账户下，这样在这个账户下可以直接创建虚拟机或者将虚拟机加入到这个网络。
如果是这个打通 Vlan 网络配在基础网络（共享网络）上，则所有用户可以用。

#####平台配置过程

其实在云平台上没有太多需要配置的，只需要正常建立一个 Vlan 网络给用户，用户直接在其上创建虚拟机即可，详细参考 关于基础网络（与 Vlan 网络）、策略路由。

#####总结

优点：打通方法对使用vlan网络的用户无感知，简单。由核心交换机负责路由转发，性能高。

不足：只适用于VLAN网络。用户不能自己指定特定的VLAN网络，需要在neutron和物理设备上预先配置好。
 
####方案二：外部网络Floathing IP打通
此方案是将用户虚机绑定FIP后再与企业内网打通，适用于任何网络类型。

#####前提

对于物理网络，云平台核心交换机需要与企业内网之间建立三层互联即可，其他配置不需要。

#####拓扑结构以及原理说明

![2]
用户创建虚机后绑定FIP，用户外网核心路由器与企业内网三层路由打通，然后虚机使用已经绑定的FIP与企业内网通信。
用户使用过程
正常创建虚机和绑定FIP，只是在用户外网路由器上与企业内网三层路由打通，并添加指向到企业内网的路由。同时，企业内网路由器需要添加回指路由。

#####平台配置过程

平台正常配置

#####总结
 
优点：用户无任何感知，操作简单。适用于任意网络类型。

不足：虚机与企业内网互访需要经过云平台的虚拟路由器，业务访问量过大时虚拟路由会成为瓶颈。


[1]: ../../images/deployment/fangan1.png
[2]: ../../images/deployment/fangan2.png